<script lang="javascript" src="/javascripts/events/page.js" defer></script>
<script lang="javascript" src="/javascripts/events/invites.js" defer></script>
<script lang="javascript" src="/javascripts/events/dropdownlist.js" defer></script>
<div>
<div class="dropdown relative inline-block text-left mt-10 mb-10"
     data-name="typeCode"          
     data-allow-empty="true"        
     data-placeholder="Event Type"   
     data-value="{{param.typeCode}}">                
  <button class="dd-btn inline-flex items-center gap-2 rounded-md border px-3 py-2 text-sm bg-white hover:bg-gray-50">
    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"/></svg>
  </button>

  <div class="dd-menu absolute left-0 mt-2 z-50 w-56 origin-top-left rounded-md border bg-white shadow-lg max-h-60 overflow-auto hidden">
    <ul class="py-1 text-sm">
      {{#each selections.typeList}}
      <li><button type="button" class="w-full text-left px-4 py-2 hover:bg-gray-50" data-value="{{this.code}}">{{this.name}}</button></li>
      {{/each}}
    </ul>
  </div>

  <input type="hidden" class="dd-input" id="q_TypeCode" name="typeCode" value="{{param.typeCode}}">
</div>

<div class="dropdown relative inline-block text-left mt-10 mb-10"
     data-name="statusCode"
     data-allow-empty="true"
     data-placeholder="Status Type"
     data-value="{{param.statusCode}}">
  <button class="dd-btn inline-flex items-center gap-2 rounded-md border px-3 py-2 text-sm bg-white hover:bg-gray-50">
    <svg class="h-4 w-4 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"/></svg>
  </button>

  <div class="dd-menu absolute left-0 mt-2 z-50 w-56 origin-top-left rounded-md border bg-white shadow-lg max-h-60 overflow-auto hidden">
    <ul class="py-1 text-sm">
      {{#each selections.statusList}}
      <li><button type="button" class="w-full text-left px-4 py-2 hover:bg-gray-50" data-value="{{this.code}}">{{this.name}}</button></li>
      {{/each}}
    </ul>
  </div>

  <input type="hidden" class="dd-input" id="q_StatusCode" name="statusCode" value="{{param.statusCode}}">
</div>

<button onclick="newSearch()" class="px-6 py-2 bg-blue-500 text-white text-sm font-semibold rounded-lg shadow-md 
               hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">Query</button>
<form id="queryForm" action="/events/list" method="get">
</form>
</div>
<ul role="list" class="divide-y divide-gray-100">
{{#each data.list}}
  <li class="flex justify-between gap-x-6 py-5">
    <div class="flex min-w-0 gap-x-4">

    <img src="/images/types_{{this.type.code}}.svg" alt="{{this.type.name}}" title="{{this.type.name}}" class="size-12 flex-none rounded-full bg-gray-50" />
      <div class="min-w-0 flex-auto">
        <p class="text-sm/6 font-semibold text-gray-900">{{this.name}}</p>
        <p class="mt-1 truncate text-xs/5 text-gray-500">{{this.status.name}}</p>
        <p class="mt-1 truncate text-xs/5 text-gray-500">{{this.states.name}}</p>
      </div>
    </div>
    <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end">

        <div class="w-full bg-gray-200 rounded-full h-6 relative">
            <div class="bg-green-500 h-6 rounded-full" style="width: {{percentage this.vacant this.seats}}"></div>
            <span class="absolute inset-0 flex items-center justify-center text-xs font-medium text-blue-500">
                {{this.vacant}} seats left
            </span>
        </div>

        <p class="mt-1 text-xs/5 text-gray-500">DUE ON {{formatDate this.deadline}}</p>
        <button onclick="createInvites({{this.id}})"class="px-6 py-2 bg-blue-500 text-white text-sm font-semibold rounded-lg shadow-md 
               hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-400">
               Create Invites
      </button>
    </div>
  </li>
{{/each}}
</ul>

<!--
  Pagination
  -->
<div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6">
  <div class="flex flex-1 justify-between sm:hidden">
    <a href="#" class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
    <a href="#" class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
  </div>
  <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
    <div>
      <p class="text-sm text-gray-700">
        Showing
        <span class="font-medium">{{data.pageInfo.from}}</span>
        to
        <span class="font-medium">{{data.pageInfo.to}}</span>
        of
        <span class="font-medium">{{data.pageInfo.recordNumbers}}</span>
        results
      </p>
    </div>
    <div>
      <form id="pageForm" action="/events/list" method="get">
      <input type="hidden" name="statusCode" value="{{param.statusCode}}"/>
      <input type="hidden" name="typeCode" value="{{param.typeCode}}"/>
      <input type="hidden" name="pageSize" value="{{data.pageInfo.pageSize}}"/>
      <nav aria-label="Pagination" class="isolate inline-flex -space-x-px rounded-md shadow-xs">
        {{#if data.pageInfo.isNotFirst}}
        <a href="#" onclick="gotoPage('pageForm', 1)" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
          <span class="sr-only">Previous</span>
          <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
            <path d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" fill-rule="evenodd" />
          </svg>
        </a>
        {{/if}}
        <!-- Current: "z-10 bg-indigo-600 text-white focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600", Default: "text-gray-900 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:outline-offset-0" -->

        {{#each data.pageInfo.pageNoArr}}
        {{#if this.current}}
        <a aria-current="page" class="relative z-10 inline-flex items-center bg-indigo-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">{{this.index}}</a>
        {{else}}
        <a href="#" onclick="gotoPage('pageForm', {{this.index}})" class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-900 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">{{this.index}}</a>
        {{/if}}
        {{/each}}

        {{#if data.pageInfo.isNotLast}}
        <a href="#" onclick="gotoPage('pageForm', {{data.pageInfo.total}})" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 inset-ring inset-ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
          <span class="sr-only">Next</span>
          <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
            <path d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
          </svg>
        </a>
        {{/if}}
      </nav>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
<el-dialog>
  <dialog id="dialog" aria-labelledby="dialog-title" class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
    <el-dialog-backdrop class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in"></el-dialog-backdrop>

    <div tabindex="0" class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
      <el-dialog-panel class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mx-auto flex size-12 shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:size-10">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-slot="icon" aria-hidden="true" class="size-6 text-red-600">
                <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </div>
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
              <h3 id="dialog-title" class="text-base font-semibold text-gray-900">Invites will expire within 24 hours</h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500 truncate max-w-sm" id="token_p"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
          <button type="button" id="copyButton" onclick="copyToClipboard()" class="inline-flex w-full justify-center rounded-md bg-blue-500 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-blue-600 sm:ml-3 sm:w-auto">Copy</button>
          <button type="button" onclick="closeInvitesDialog()" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
        </div>
      </el-dialog-panel>
    </div>
  </dialog>
</el-dialog>


<script>
  function newSearch(){

    let typeCode = document.createElement("input")
    let statusCode = document.createElement("input")
    typeCode.type = "hidden"
    statusCode.type = "hidden"
    typeCode.name = "typeCode"
    statusCode.name = "statusCode"
    typeCode.value = document.getElementById("q_TypeCode").value
    statusCode.value = document.getElementById("q_StatusCode").value

    let form = document.getElementById("queryForm")
    form.appendChild(typeCode)
    form.appendChild(statusCode)
    form.submit()
  }
</script>